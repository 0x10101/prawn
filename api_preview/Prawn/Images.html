<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Module: Prawn::Images
  
    &mdash; Prawn Documentation
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../';
  framesUrl = "../frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (I)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../Prawn.html" title="Prawn (module)">Prawn</a></span></span>
     &raquo; 
    <span class="title">Images</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Module: Prawn::Images
  
  
  
</h1>

<dl class="box">
  
  
    
  
    
  
  
    <dt class="r1">Included in:</dt>
    <dd class="r1"><span class='object_link'><a href="Document.html" title="Prawn::Document (class)">Document</a></span></dd>
    
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/prawn/images.rb<span class="defines">,<br />
  lib/prawn/images/png.rb,<br /> lib/prawn/images/jpg.rb,<br /> lib/prawn/images/image.rb</span>
</dd>
  
</dl>
<div class="clear"></div>

<h2>Defined Under Namespace</h2>
<p class="children">
  
    
  
    
      <strong class="classes">Classes:</strong> <span class='object_link'><a href="Images/Image.html" title="Prawn::Images::Image (class)">Image</a></span>, <span class='object_link'><a href="Images/JPG.html" title="Prawn::Images::JPG (class)">JPG</a></span>, <span class='object_link'><a href="Images/PNG.html" title="Prawn::Images::PNG (class)">PNG</a></span>
    
  
</p>







  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#build_image_object-instance_method" title="#build_image_object (instance method)">- (Object) <strong>build_image_object</strong>(file) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Builds an info object (Prawn::Images::*) and a PDF reference representing
the given image.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#embed_image-instance_method" title="#embed_image (instance method)">- (Object) <strong>embed_image</strong>(pdf_obj, info, options) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Given a PDF image resource pdf_obj that has been added to the page&#39;s
resources and an info object (the pair returned from build_image_object),
embed the image according to the options given.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#image-instance_method" title="#image (instance method)">- (Object) <strong>image</strong>(file, options = {}) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Add the image at filename to the current page.</p>
</div></span>
  
</li>

      
    </ul>
  



  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="build_image_object-instance_method">
  
    - (<tt>Object</tt>) <strong>build_image_object</strong>(file) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Builds an info object (Prawn::Images::*) and a PDF reference representing
the given image. Return a pair: [pdf_obj, info].</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/prawn/images.rb', line 74</span>

<span class='kw'>def</span> <span class='id identifier rubyid_build_image_object'>build_image_object</span><span class='lparen'>(</span><span class='id identifier rubyid_file'>file</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_io'>io</span> <span class='op'>=</span> <span class='id identifier rubyid_verify_and_open_image'>verify_and_open_image</span><span class='lparen'>(</span><span class='id identifier rubyid_file'>file</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_image_content'>image_content</span> <span class='op'>=</span> <span class='id identifier rubyid_io'>io</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span>
  <span class='id identifier rubyid_image_sha1'>image_sha1</span> <span class='op'>=</span> <span class='const'>Digest</span><span class='op'>::</span><span class='const'>SHA1</span><span class='period'>.</span><span class='id identifier rubyid_hexdigest'>hexdigest</span><span class='lparen'>(</span><span class='id identifier rubyid_image_content'>image_content</span><span class='rparen'>)</span>

  <span class='comment'># if this image has already been embedded, just reuse it
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_image_registry'>image_registry</span><span class='lbracket'>[</span><span class='id identifier rubyid_image_sha1'>image_sha1</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_info'>info</span> <span class='op'>=</span> <span class='id identifier rubyid_image_registry'>image_registry</span><span class='lbracket'>[</span><span class='id identifier rubyid_image_sha1'>image_sha1</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:info</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_image_obj'>image_obj</span> <span class='op'>=</span> <span class='id identifier rubyid_image_registry'>image_registry</span><span class='lbracket'>[</span><span class='id identifier rubyid_image_sha1'>image_sha1</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:obj</span><span class='rbracket'>]</span>
  <span class='kw'>else</span>
    <span class='comment'># Build the image object
</span>    <span class='id identifier rubyid_info'>info</span> <span class='op'>=</span> <span class='const'>Prawn</span><span class='period'>.</span><span class='id identifier rubyid_image_handler'>image_handler</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_image_content'>image_content</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_image_content'>image_content</span><span class='rparen'>)</span>

    <span class='comment'># Bump PDF version if the image requires it
</span>    <span class='id identifier rubyid_min_version'>min_version</span><span class='lparen'>(</span><span class='id identifier rubyid_info'>info</span><span class='period'>.</span><span class='id identifier rubyid_min_pdf_version'>min_pdf_version</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_info'>info</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:min_pdf_version</span><span class='rparen'>)</span>

    <span class='comment'># Add the image to the PDF and register it in case we see it again.
</span>    <span class='id identifier rubyid_image_obj'>image_obj</span> <span class='op'>=</span> <span class='id identifier rubyid_info'>info</span><span class='period'>.</span><span class='id identifier rubyid_build_pdf_object'>build_pdf_object</span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_image_registry'>image_registry</span><span class='lbracket'>[</span><span class='id identifier rubyid_image_sha1'>image_sha1</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='symbol'>:obj</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_image_obj'>image_obj</span><span class='comma'>,</span> <span class='symbol'>:info</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_info'>info</span><span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='lbracket'>[</span><span class='id identifier rubyid_image_obj'>image_obj</span><span class='comma'>,</span> <span class='id identifier rubyid_info'>info</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="embed_image-instance_method">
  
    - (<tt>Object</tt>) <strong>embed_image</strong>(pdf_obj, info, options) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Given a PDF image resource <code>pdf_obj</code> that has been added to the
page&#39;s resources and an <code>info</code> object (the pair returned
from build_image_object), embed the image according to the
<code>options</code> given.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/prawn/images.rb', line 103</span>

<span class='kw'>def</span> <span class='id identifier rubyid_embed_image'>embed_image</span><span class='lparen'>(</span><span class='id identifier rubyid_pdf_obj'>pdf_obj</span><span class='comma'>,</span> <span class='id identifier rubyid_info'>info</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='comment'># find where the image will be placed and how big it will be
</span>  <span class='id identifier rubyid_w'>w</span><span class='comma'>,</span><span class='id identifier rubyid_h'>h</span> <span class='op'>=</span> <span class='id identifier rubyid_info'>info</span><span class='period'>.</span><span class='id identifier rubyid_calc_image_dimensions'>calc_image_dimensions</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:at</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_x'>x</span><span class='comma'>,</span><span class='id identifier rubyid_y'>y</span> <span class='op'>=</span> <span class='id identifier rubyid_map_to_absolute'>map_to_absolute</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:at</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_x'>x</span><span class='comma'>,</span><span class='id identifier rubyid_y'>y</span> <span class='op'>=</span> <span class='id identifier rubyid_image_position'>image_position</span><span class='lparen'>(</span><span class='id identifier rubyid_w'>w</span><span class='comma'>,</span><span class='id identifier rubyid_h'>h</span><span class='comma'>,</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_move_text_position'>move_text_position</span> <span class='id identifier rubyid_h'>h</span>
  <span class='kw'>end</span>

  <span class='comment'># add a reference to the image object to the current page
</span>  <span class='comment'># resource list and give it a label
</span>  <span class='id identifier rubyid_label'>label</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>I</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_next_image_id'>next_image_id</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_state'>state</span><span class='period'>.</span><span class='id identifier rubyid_page'>page</span><span class='period'>.</span><span class='id identifier rubyid_xobjects'>xobjects</span><span class='period'>.</span><span class='id identifier rubyid_merge!'>merge!</span><span class='lparen'>(</span><span class='id identifier rubyid_label'>label</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_pdf_obj'>pdf_obj</span><span class='rparen'>)</span>

  <span class='comment'># add the image to the current page
</span>  <span class='id identifier rubyid_instruct'>instruct</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\nq\n%.3f 0 0 %.3f %.3f %.3f cm\n/%s Do\nQ</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_add_content'>add_content</span> <span class='id identifier rubyid_instruct'>instruct</span> <span class='op'>%</span> <span class='lbracket'>[</span> <span class='id identifier rubyid_w'>w</span><span class='comma'>,</span> <span class='id identifier rubyid_h'>h</span><span class='comma'>,</span> <span class='id identifier rubyid_x'>x</span><span class='comma'>,</span> <span class='id identifier rubyid_y'>y</span> <span class='op'>-</span> <span class='id identifier rubyid_h'>h</span><span class='comma'>,</span> <span class='id identifier rubyid_label'>label</span> <span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="image-instance_method">
  
    - (<tt>Object</tt>) <strong>image</strong>(file, options = {}) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Add the image at filename to the current page. Currently only JPG and PNG
files are supported. (Note that processing PNG images with alpha channels
can be processor and memory intensive.)</p>

<p>Arguments:</p>
<dl class="rdoc-list note-list"><dt><code>file</code>
<dd>
<p>path to file or an object that responds to #read</p>
</dd></dl>

<p>Options:</p>
<dl class="rdoc-list note-list"><dt><code>:at</code>
<dd>
<p>an array [x,y] with the location of the top left corner of the image.</p>
</dd><dt><code>:position</code>
<dd>
<p>One of (:left, :center, :right) or an x-offset</p>
</dd><dt><code>:vposition</code>
<dd>
<p>One of (:top, :center, :center) or an y-offset</p>
</dd><dt><code>:height</code>
<dd>
<p>the height of the image [actual height of the image]</p>
</dd><dt><code>:width</code>
<dd>
<p>the width of the image [actual width of the image]</p>
</dd><dt><code>:scale</code>
<dd>
<p>scale the dimensions of the image proportionally</p>
</dd><dt><code>:fit</code>
<dd>
<p>scale the dimensions of the image proportionally to fit inside
[width,height]</p>
</dd></dl>

<pre class="ruby"><span class="ruby-constant">Prawn</span><span class="ruby-operator">::</span><span class="ruby-constant">Document</span>.<span class="ruby-identifier">generate</span>(<span class="ruby-string">&quot;image2.pdf&quot;</span>, :<span class="ruby-identifier">page_layout</span> =<span class="ruby-operator">&gt;</span> :<span class="ruby-identifier">landscape</span>) <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">pigs</span> = <span class="ruby-node">&quot;#{Prawn::DATADIR}/images/pigs.jpg&quot;</span>
  <span class="ruby-identifier">image</span> <span class="ruby-identifier">pigs</span>, :<span class="ruby-identifier">at</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value">50</span>,<span class="ruby-value">450</span>], :<span class="ruby-identifier">width</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">450</span>

  <span class="ruby-identifier">dice</span> = <span class="ruby-node">&quot;#{Prawn::DATADIR}/images/dice.png&quot;</span>
  <span class="ruby-identifier">image</span> <span class="ruby-identifier">dice</span>, :<span class="ruby-identifier">at</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value">50</span>, <span class="ruby-value">450</span>], :<span class="ruby-identifier">scale</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0.75</span>
<span class="ruby-keyword">end</span>
</pre>

<p>If only one of :width / :height are provided, the image will be scaled
proportionally.  When both are provided, the image will be stretched to fit
the dimensions without maintaining the aspect ratio.</p>

<p>If :at is provided, the image will be place in the current page but the
text position will not be changed.</p>

<p>If instead of an explicit filename, an object with a read method is passed
as <code>file</code>, you can embed images from IO objects and things that
act like them (including Tempfiles and open-uri objects).</p>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&quot;open-uri&quot;</span>

<span class="ruby-constant">Prawn</span><span class="ruby-operator">::</span><span class="ruby-constant">Document</span>.<span class="ruby-identifier">generate</span>(<span class="ruby-string">&quot;remote_images.pdf&quot;</span>) <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">image</span> <span class="ruby-identifier">open</span>(<span class="ruby-string">&quot;http://prawn.majesticseacreature.com/media/prawn_logo.png&quot;</span>)
<span class="ruby-keyword">end</span>
</pre>

<p>This method returns an image info object which can be used to check the
dimensions of an image object if needed. (See also: Prawn::Images::PNG ,
Prawn::Images::JPG)</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


61
62
63
64
65
66
67
68
69</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/prawn/images.rb', line 61</span>

<span class='kw'>def</span> <span class='id identifier rubyid_image'>image</span><span class='lparen'>(</span><span class='id identifier rubyid_file'>file</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='op'>=</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='const'>Prawn</span><span class='period'>.</span><span class='id identifier rubyid_verify_options'>verify_options</span> <span class='lbracket'>[</span><span class='symbol'>:at</span><span class='comma'>,</span> <span class='symbol'>:position</span><span class='comma'>,</span> <span class='symbol'>:vposition</span><span class='comma'>,</span> <span class='symbol'>:height</span><span class='comma'>,</span>
                        <span class='symbol'>:width</span><span class='comma'>,</span> <span class='symbol'>:scale</span><span class='comma'>,</span> <span class='symbol'>:fit</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span>

  <span class='id identifier rubyid_pdf_obj'>pdf_obj</span><span class='comma'>,</span> <span class='id identifier rubyid_info'>info</span> <span class='op'>=</span> <span class='id identifier rubyid_build_image_object'>build_image_object</span><span class='lparen'>(</span><span class='id identifier rubyid_file'>file</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_embed_image'>embed_image</span><span class='lparen'>(</span><span class='id identifier rubyid_pdf_obj'>pdf_obj</span><span class='comma'>,</span> <span class='id identifier rubyid_info'>info</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_info'>info</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Fri Jan 17 13:28:43 2014 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.3 (ruby-2.0.0).
</div>

  </body>
</html>